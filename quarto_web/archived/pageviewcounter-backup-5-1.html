<!-- GoatCounter Tracker -->
<script data-goatcounter="https://statsupai.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

<!-- Per-Page View Counter (Footer Style) -->
<style>
#goatcounter-footer {
  font-size: 0.85em;
  color: #AAA;
  text-align: center;
  margin-top: 1em;
  margin-bottom: 3em;
  font-family: sans-serif;
}
</style>

<div id="goatcounter-footer">Loading views...</div>
<script>
  // Fetch the page view count from GoatCounter API
  const path = window.location.pathname;
  
  fetch(`https://statsupai.goatcounter.com/api/v0/stats/hits`, {
    headers: { "Authorization": "Bearer auxp85q97cp69ebjpxnwl6po1kaj3megn0nej25li5q72yx3t" }
  })
    .then(res => res.json())
    .then(data => {
      const display = document.getElementById("goatcounter-footer");
      if (display) {
        // API response is an array of hits per path
        console.log("Page views data:", data);
        console.log("data.hits", data.hits);
        console.log("path:", path);
        // Trim path to remove everything before /quarto_web/site/
        const trimmedPath = path.replace(/^.*\/quarto_web\/site\//, '\/quarto_web\/site\/');
        console.log("trimmedPath:", trimmedPath);
        // From the array data.hits, filter out the hits for the current path
        const hit = data.hits.find(hit => hit.path === trimmedPath);
        // const views = data.find(hit => hit.path === path)?.count || 0;
        console.log("hit:", hit);
        // If hit is found, get the count, otherwise default to 0
        const views = hit.count || 0;
        // If hit is found, get the count, otherwise default to 0
        // const views = hit ? hit.count : 0; // WHY does this NOT work?
        console.log("views:", views);
        display.innerHTML = `<span style="font-family: 'Courier New', monospace; color: #0033cc;">Views: ${views}</span>`;
        console.log("Display updated with views:", views);
      }
    })
    .catch(() => {
      const display = document.getElementById("goatcounter-footer");
      if (display) display.innerHTML = "Page views unavailable. Try again later.";
    });
</script>


