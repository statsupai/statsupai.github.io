<!-- GoatCounter Tracker -->
<script data-goatcounter="https://statsupai.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

<!-- Per-Page View Counter (Footer Style) -->
<style>
#goatcounter-footer {
  --gc-counter-color: #2b786bef;
  display: inline-flex; 
  align-items: center; 
  column-gap: 5px;
  white-space: nowrap;
  color: #8e8e8e; 
  font-size: 13px; 
  font-family: Arial, sans-serif;
}
#goatcounter-footer .statcounter {
  font-family: 'Courier New', monospace; 
  color: var(--gc-counter-color);
  font-weight: bold; 
  margin-left: 3px; 
}
</style>

<!-- GoatCounter Tracker -->
<div id="goatcounter-footer"><span style="margin-left: 3px;">Loading views...</span></div>
<script>
    const path = window.location.pathname;
    console.log('window.location.pathname:', path);
    // If at the root, skip fetching views for now
    if (path.endsWith('index.html') || path.endsWith('/posts/')) {
      
      const display = document.getElementById("goatcounter-footer");
      if (display) {
        display.innerHTML = "";
        console.log("Skipping views for root path:", path);
      }
      
    } else {
      
      // Trim path to remove everything before /quarto_web/site/ for easier local testing
      var trimmedPath = path.replace(/^.*\/posts\//, '\/quarto_web\/site\/posts\/');
      // If the path is exactly /posts/, set trimmedPath to the index.html file
      if (path === '\/posts\/') {
          console.log('Path is exactly /posts/, setting trimmedPath to index.html');
          trimmedPath = '/quarto_web/site/posts/index.html';
      }
      console.log('trimmedPath:', trimmedPath);
      
      // setInterval to check every 100ms because GoatCounter may not be available immediately
      var t = setInterval(function() {
          console.log('Checking for GoatCounter availability...window.goatcounter:', window.goatcounter);
          // Check if GoatCounter is available
          if (window.goatcounter && window.goatcounter.visit_count) {

              // GoatCounter is available, clear the timer
              clearInterval(t)
              // Resolve the counter color to a concrete value
              var footer = document.getElementById('goatcounter-footer');
              var resolvedColor = footer ? getComputedStyle(footer).getPropertyValue('--gc-counter-color').trim() : '';
              console.log('Resolved counter color:', resolvedColor);
              // Update the display with the current visit count
              const display = document.getElementById("goatcounter-footer");
              if (display) {
                display.innerHTML = '<span>Page Views: </span>';
                console.log('display.innerHTML:', display.innerHTML);
              }
              
              
              goatcounter.visit_count({
                no_branding: true,
                path: trimmedPath,
                append: '#goatcounter-footer', 
                style: `
                  body {
                    background: transparent !important;
                  }
                  div { 
                    background: transparent !important;
                    border-width: 0px;
                    border: 0 !important;
                    display: flex;
                  }
                  #gcvc-for {
                    font-size: 0px;
                  }
                  #gcvc-views { 
                      font-family: 'Courier New', monospace; 
                      font-size: 13px;
                      color: ${resolvedColor}; 
                      font-weight: bold; 
                      margin-top: 23px; 
                  }`
              })

          }
      }, 100)
      
    }
</script>
